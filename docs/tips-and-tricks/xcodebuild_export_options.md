# Xcode archive export options

On bitrise __xcode-archive step__ is responsible for __archive__ your iOS project and __export the ipa__. If you create a new app on bitrise (using our iOS sample) and set the __stack__ to __Xcode 6.4, on OS X 10.11__ the archive step's export command looks like:

```
xcodebuild -exportArchive \
	-exportFormat ipa \
	-archivePath "/var/folders/lb/8n5bn9k975qgw662jpqdy7mm0000gn/T/bitrise-xcarchive.YnAMfpzJ/ios-simple-objc.xcarchive" \
	-exportPath "/Users/vagrant/deploy/ios-simple-objc.ipa" \
	-exportProvisioningProfile "BitriseBot-Wildcard"
```

If you run similar command in __Xcode 7__ environment, this command will throw an error: 


```
xcodebuild: WARNING: -exportArchive without -exportOptionsPlist is deprecated
```

The export command's __new version with export options__ looks like:

```
xcodebuild -exportArchive \
	-archivePath "/var/folders/lb/8n5bn9k975qgw662jpqdy7mm0000gn/T/bitrise-xcarchive.QbpHVvNx/ios-simple-objc.xcarchive" \
	-exportPath "/var/folders/lb/8n5bn9k975qgw662jpqdy7mm0000gn/T/bitrise-xcarchive.aCvNPRAi" \
	-exportOptionsPlist "/Users/vagrant/deploy/export_options.plist"
```

The step generates and uses the following __export options plist file__ ( *if export_options_path input is left empty* ):

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>method</key>
	<string>development</string>
</dict>
</plist>
```

So since Xcode 7 we use `-exportOptionsPlist` to configure the export process.  
__xcode-archive__ step has a related __input__: `export_options_path`.  
This input is empty by default, this means the step cares about creating the export options. 

## The xcode-archive step generated export options 

The default __generated__ export options only specifies the __export method__ ( *app-store, ad-hoc, enterprise or development* ) based on the provisioning profile embedded in the xcarhive, which was generated by the xcodebuild archive and used to export the ipa.  

*Embedded provisioning profile depends on your code sign settings in your project. You can force the desired code sign with xcode-archive step's `force_code_sign_identity` and `force_provisioning_profile` inputs.*  

Other export options are on default value. See all options by calling: `xcodebuild -h` in *Available keys for -exportOptionsPlist:* section.

## Use your own export options

In case of the default export_options.plist does not fit to your requirements, you can specify your own export options too.  
To do this create a plist file with your options. 

See all options by calling: `xcodebuild -h` in *Available keys for -exportOptionsPlist:* section.

*You select the same options in Xcode when you export the ipa manually.*

The __recommanded__ way is to __put this generated plist file in your project's repository__, so it will be available on bitrise as well. Then you can set xcode-archive step's `export_options_path` to the path of your plist file.

### Disable bitcode in ipa

__By default uploadBitcode export options is YES__, if it does not fit your requirements you have to use your own export options, instead of the archive steps generated one.

Your export options plist may looks like:

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>method</key>
	<string>app-store</string>
	<key>uploadBitcode</key>
	<false/>
</dict>
</plist>
```

### Related issues:

* __ERROR ITMS-90635: Invalid Mach-O Format__ :

```
Transporter Error Output: ERROR ITMS-90635: Invalid Mach-O Format.
...
Verify that all of the targets for a platform have a consistent value for the ENABLE_BITCODE build setting.
...
```

  This error appears, if your project's `ENABLE_BITCODE` settings differs from your pod project's settings.  
  You can __override ENABLE_BITCODE in your pod projects__, by modifying yor podfile:
  
```
post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['ENABLE_BITCODE'] = 'NO'
    end
  end
end
```
